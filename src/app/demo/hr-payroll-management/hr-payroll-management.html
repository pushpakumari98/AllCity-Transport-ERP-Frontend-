<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h3>ðŸ’¼ HR Payroll Management</h3>
  </div>

  <!-- Manage Leave Types Section -->
  <div class="mb-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h5 class="mb-0" style="color: #6f42c1;">Manage Leave Types</h5>
      <div class="d-flex gap-2">
        <!-- Apply Leave Button -->
        <button type="button" class="btn btn-success btn-sm" (click)="openLeaveApplicationModal()">
          <i class="fa fa-calendar-plus me-2"></i>Apply Leave
        </button>
        <!-- Add Leave Type Button -->
        <button class="btn btn-primary btn-sm" (click)="openLeaveTypesModal()">
          <i class="fa fa-plus me-2"></i>Add Leave Type
        </button>
        <!-- Export Dropdown -->
        <div class="dropdown">
          <button type="button" class="btn btn-primary btn-sm dropdown-toggle" (click)="toggleExportDropdown()" [attr.aria-expanded]="showExportDropdown">
            <i class="fa fa-download me-2"></i>Export
          </button>
          <ul class="dropdown-menu" [class.show]="showExportDropdown">
            <li><a class="dropdown-item" href="#" (click)="exportLeaveApplications('csv'); showExportDropdown = false">
              <i class="fa fa-file-csv me-2"></i>CSV
            </a></li>
            <li><a class="dropdown-item" href="#" (click)="exportLeaveApplications('pdf'); showExportDropdown = false">
              <i class="fa fa-file-pdf me-2"></i>PDF
            </a></li>
            <li><a class="dropdown-item" href="#" (click)="exportLeaveApplications('excel'); showExportDropdown = false">
              <i class="fa fa-file-excel me-2"></i>Excel
            </a></li>
            <li><a class="dropdown-item" href="#" (click)="exportLeaveApplications('docx'); showExportDropdown = false">
              <i class="fa fa-file-word me-2"></i>Word (DOCX)
            </a></li>
          </ul>
        </div>
        <!-- Print Button -->
        <button type="button" class="btn btn-secondary btn-sm" (click)="printLeaveApplications()">
          <i class="fa fa-print me-2"></i>Print
        </button>
      </div>
    </div>

    <div class="card">
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-bordered mb-0">
            <thead style="background-color: #f8f9fa;">
              <tr>
                <th class="text-center">Leave Type</th>
                <th class="text-center">Max Days/Year</th>
                <th class="text-center">Description</th>
                <th class="text-center">Status</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let leaveType of leaveTypes">
                <td class="text-center">{{ leaveType.name }}</td>
                <td class="text-center">{{ leaveType.maxDaysPerYear }}</td>
                <td class="text-center">{{ leaveType.description }}</td>
                <td class="text-center">
                  <span class="badge" [ngClass]="leaveType.status === 'Active' ? 'bg-success' : 'bg-secondary'">
                    {{ leaveType.status }}
                  </span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Leave Applications Section -->
  <div class="mb-4">
    <h5 class="mb-3" style="color: #28a745;">Leave Applications</h5>
    <div class="card">
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-bordered mb-0" *ngIf="leaveApplications.length > 0">
            <thead style="background-color: #e8f5e8;">
              <tr>
                <th class="text-center">Employee</th>
                <th class="text-center">Leave Type</th>
                <th class="text-center">Start Date</th>
                <th class="text-center">End Date</th>
                <th class="text-center">Reason</th>
                <th class="text-center">Status</th>
                <th class="text-center">Applied Date</th>
                <th class="text-center">Action</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let application of leaveApplications">
                <td class="text-center">{{ application.employeeName }}</td>
                <td class="text-center">{{ application.leaveTypeName }}</td>
                <td class="text-center">{{ application.startDate }}</td>
                <td class="text-center">{{ application.endDate }}</td>
                <td class="text-center">{{ application.reason }}</td>
                <td class="text-center">
                  <span class="badge" [ngClass]="application.status === 'Approved' ? 'bg-success' : application.status === 'Rejected' ? 'bg-danger' : 'bg-warning'">
                    {{ application.status }}
                  </span>
                </td>
                <td class="text-center">{{ application.appliedDate }}</td>
                <td class="text-center">
                  <button class="btn btn-sm btn-warning me-2"
                          (click)="updateLeaveApplication(application)"
                          title="Update">
                    <i class="fa fa-edit"></i>
                  </button>
                  <button class="btn btn-sm btn-danger"
                          (click)="deleteLeaveApplication(application)"
                          title="Delete">
                    <i class="fa fa-trash"></i>
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <div *ngIf="leaveApplications.length === 0" class="text-center py-4" style="background-color: #f8fff8; border-radius: 0 0 5px 5px;">
          <p class="text-muted mb-2">No leave applications found.</p>
          <small class="text-muted">Leave applications will appear here.</small>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- CONFIRMATION DIALOG -->
<div *ngIf="showConfirmationDialog" class="modal-backdrop fade show" style="z-index: 1055;"></div>
<div *ngIf="showConfirmationDialog" class="modal" tabindex="-1" style="display:block; z-index: 1056;">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Delete Leave Application</h5>
        <button type="button" class="btn-close" (click)="onCancelDeleteLeaveApplication()"></button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to delete this leave application? This action cannot be undone.</p>
        <div *ngIf="selectedLeaveApplicationToDelete" class="alert alert-warning">
          <strong>Application Details:</strong><br>
          Employee: {{ selectedLeaveApplicationToDelete.employeeName }}<br>
          Leave Type: {{ selectedLeaveApplicationToDelete.leaveTypeName }}<br>
          Dates: {{ selectedLeaveApplicationToDelete.startDate }} to {{ selectedLeaveApplicationToDelete.endDate }}
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="onCancelDeleteLeaveApplication()">Cancel</button>
        <button type="button" class="btn btn-danger" (click)="onConfirmDeleteLeaveApplication()">Delete</button>
      </div>
    </div>
  </div>
</div>

<!-- LEAVE APPLICATION MODAL -->
<div *ngIf="showLeaveApplicationModal" class="modal-backdrop fade show" style="z-index: 1055;"></div>
<div *ngIf="showLeaveApplicationModal" class="modal" tabindex="-1" style="display:block; z-index: 1056;">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">{{ editMode ? 'Update Leave Application' : 'Apply for Leave' }}</h5>
        <button type="button" class="btn-close" (click)="closeLeaveApplicationModal()"></button>
      </div>
      <div class="modal-body">
        <form [formGroup]="leaveApplicationForm">
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Employee <span class="text-danger">*</span></label>
              <select class="form-control" formControlName="employeeId">
                <option [ngValue]="null">-- Select Employee --</option>
                <option *ngFor="let emp of employees" [ngValue]="emp.id">
                  {{ emp.name }}
                </option>
              </select>
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Leave Type <span class="text-danger">*</span></label>
              <select class="form-control" formControlName="leaveTypeId">
                <option [ngValue]="null">-- Select Leave Type --</option>
                <option *ngFor="let leaveType of leaveTypes" [ngValue]="leaveType.id">
                  {{ leaveType.name }}
                </option>
              </select>
            </div>
          </div>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Start Date <span class="text-danger">*</span></label>
              <input type="date" class="form-control" formControlName="startDate" />
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">End Date <span class="text-danger">*</span></label>
              <input type="date" class="form-control" formControlName="endDate" />
            </div>
          </div>
          <div class="mb-3">
            <label class="form-label">Reason <span class="text-danger">*</span></label>
            <textarea class="form-control" rows="3" formControlName="reason"
                      placeholder="Please provide a reason for your leave application"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeLeaveApplicationModal()">Cancel</button>
        <button type="button" class="btn btn-primary" (click)="submitLeaveApplication()"
                [disabled]="leaveApplicationForm.invalid">Submit Application</button>
      </div>
    </div>
  </div>
</div>

<!-- ADD LEAVE TYPE MODAL -->
<div *ngIf="showLeaveTypesModal" class="modal-backdrop fade show" style="z-index: 1055;"></div>
<div *ngIf="showLeaveTypesModal" class="modal" tabindex="-1" style="display:block; z-index: 1056;">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Add Leave Type</h5>
        <button type="button" class="btn-close" (click)="closeLeaveTypesModal()"></button>
      </div>
      <div class="modal-body">
        <form [formGroup]="leaveTypeForm">
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label">Leave Type Name <span class="text-danger">*</span></label>
              <input type="text" class="form-control" formControlName="name"
                     placeholder="e.g., Annual Leave, Casual Leave" />
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label">Maximum Days Per Year <span class="text-danger">*</span></label>
              <input type="number" class="form-control" formControlName="maxDaysPerYear" min="1"
                     placeholder="e.g., 30" />
            </div>
          </div>
          <div class="mb-3">
            <label class="form-label">Description <span class="text-danger">*</span></label>
            <textarea class="form-control" rows="3" formControlName="description"
                      placeholder="Describe the leave type"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeLeaveTypesModal()">Cancel</button>
        <button type="button" class="btn btn-primary" (click)="addLeaveType()"
                [disabled]="leaveTypeForm.invalid">Add Leave Type</button>
      </div>
    </div>
  </div>
</div>
